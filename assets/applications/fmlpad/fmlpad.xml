<FML title="FmlPad" linkable="true" onstart="theme({STASH.FmlPadMode} ?? {THEME.brightness} == 'dark' ?'dark':'light');">

    <VAR id="root" value="https://fml.dev/"/>
    <VAR id="p1"   value="{example}" onchange="dbExample.url.set(join({root.value},{p1.value}))"/>
    <VAR id="xml"  value="{editor}" onchange="{r1} ? fmlpad.replaceChildren({xml},false) : null"/>

    <GET id="dbWidgets"  url="=join({root},'fmlpad/widgets.xml')"  root="WIDGETS.WIDGET" ttl="1m"/>
    <GET id="dbStyles"   url="=join({root},'fmlpad/styles.xml')"   root="STYLES.STYLE" ttl="1d"/>
    <GET id="dbExamples" url="=join({root},'fmlpad/examples.xml')" root="EXAMPLES.EXAMPLE"/>
    <GET id="dbExample"  url="{p1}" onsuccess="editor.set({this.response})" refresh="true"/>

    <CONST id="default">
        <value>
            <![CDATA[<!-- Welcome to FmlPad! -->
<FML>
    <!-- Remember, the template is a STACK by default and non scrollable! -->
    <!-- For scrolling, try out the SCROLL widget! -->
    <BOX center="true" pad="40">
        <!-- title bar -->
        <ROW center="true">
            <IMAGE height="50" url="assets://applications/fmlpad/fmlpad.png"/>
            <PAD right="10"/>
            <TEXT value="**Welcome to FMLPad!**" style="h4" color="{THEME.primary}"/>
        </ROW>
        <!-- text block -->
        <PAD top="20"/>
        <TEXT  value="***FmlPad** allows you to test and develop FML templates **realtime** _without the need to compile_ any code.*" size="14"/>
        <!-- text block -->
        <PAD top="10"/>
        <TEXT value="*Try adding, removing or changing any of the markup text in the left editor window and see your changes reflected here instantly.*" size="14"/>
        <!-- text block -->
        <PAD top="10"/>
        <TEXT value="***FmlPad** itself it written entirely in **FML** with less than a few dozen simple lines of markup text!*" size="14"/>
        <!-- text block -->
        <PAD top="20"/>
        <ICON icon="face" color="{THEME.primary}"/>
        <PAD top="5"/>
        <TEXT value="*Happy Templating ...*" size="14"/>
        <PAD top="5"/>
        <TEXT italic="true" value="**The FML Development Team**" size="14"/>
    </BOX>
</FML>

]]>
        </value>
    </CONST>

    <HEADER height="50">
        <VAR id="isSmall" value="={SYSTEM.screenwidth}&lt;800"/>
        <BOX color="{THEME.oninversesurface}" valign="center" halign="left" layout="row">

            <!-- logo -->
            <PAD left="20"/>
            <IMAGE url="assets://images/fml-logo.png" height="30"/>
            <PAD left="10"/>
            <TEXT value="FmlPad" visible="=!{isSmall}" size="20"/>
            <PAD left="50" visible="=!{isSmall}"/>

            <!-- widgets -->
            <SELECT bordercolor="transparent" onchange="copy({this})" data="dbWidgets" hint="Widgets" width="150"  visible="=!{isSmall}">
                <OPTION value="{data.value}" label="&lt;{data.title}/&gt;"/>
            </SELECT>

            <PAD left="20"/>

            <!-- examples -->
            <TYPEAHEAD id="examples" bordercolor="transparent" value="" data="dbExamples" hint="Examples" width="250" onchange="p1.set({this.value})">
                <OPTION value="{data.url}">
                    <label><ROW valign="center" expand="false"><ICON icon="{data.icon}" size="16" color="{data.color}"/><PAD left="10"/><TEXT value="{data.title}"/></ROW></label>
                </OPTION>
            </TYPEAHEAD>

            <!-- realtime slider -->
            <EXPAND>
                <ROW halign="end" valign="center">

                    <!-- Reset button -->
                    <BUTTON onclick="editor.set({default});examples.set(null);" visible="={default} != {editor}">
                        <ICON icon="refresh" size="24"/>
                    </BUTTON>

                    <PAD left="20"/>

                    <!-- Save button -->
                    <BUTTON onclick="saveas({editor},'fmlpad.xml')" visible="=!{isSmall}">
                        <ICON icon="save" size="24"/>
                    </BUTTON>

                    <PAD left="20"/>

                    <!-- Open button -->
                    <FILEPICKER id="fp1" onsuccess="editor.set({fp1.data.text})" allow=".xml"/>
                    <BUTTON onclick="fp1.start()" visible="=!{isSmall}">
                        <ICON icon="folder" size="24"/>
                    </BUTTON>

                    <PAD left="40"/>

                    <!-- Realtime Parsing button -->
                    <TEXT value="Realtime:" color="={r1} ? '{THEME.primary}' : '{THEME.outline}'" visible="=!{isSmall}"/>
                    <PAD left="20"/>
                    <SWITCH id="r1" value="true" onchange="{this} ? fmlpad.replaceChildren({xml},false) : null" visible="=!{isSmall}"/>
                    <PAD left="20"/>

                </ROW>
            </EXPAND>
        </BOX>
    </HEADER>

    <FOOTER height="50">
        <BOX color="{THEME.oninversesurface}" layout="row" halign="end" valign="center">
            <LOG id="log1"/>
            <EXPAND>
                
                <!--Error text display here-->
                <TEXT color="{THEME.error}" value="{log1.xml}"/>
            </EXPAND>
            <!-- themes -->
            <PAD right="10"/>
            <SELECT id="theme" width="180" border="none" data="dbStyles" value="=nvl({STASH.FmlPadTheme},'solarized-dark')" hint="Select an Editor Theme" onchange="stash('FmlPadTheme',{this.value})">
                <OPTION label='{data.label}'/>
            </SELECT>
            <PAD right="40"/>
            <ICON icon="light_mode" color="=!{mode} ? '#e6cc00' : 'grey'"/>
            <PAD right="6"/>
            <SWITCH id="mode"  value="={STASH.FmlPadMode} ?? {THEME.brightness} == 'dark'" onchange="stash('FmlPadMode',{this.value});theme({this}?'dark':'light');"/>
            <PAD right="6"/>
            <ICON icon="dark_mode" color="={mode} ? '{THEME.primary}' : 'grey'"/>
            <PAD right="20"/>
        </BOX>
    </FOOTER>

    <SPLITVIEW ratio=".50" dividerwidth="6.0" dividercolor="" dividerhandlecolor="{THEME.primary}">

        <VIEW>
            <BOX color="{THEME.background}" width="100%" height="100%" layout="stack">

                <ANIMATION id="flippy" type="flip" duration="500" axis="vertical">
                    <SCROLLER>
                        <EDITOR id="editor" language="xml" value="{default}" theme="={theme} ?? solarized-light" />
                    </SCROLLER>
                    <GRID data="dbExamples" direction="vertical">
                        <ITEM width="200" height="90">
                        <PAD all="10">
                            <ANIMATION id="flippy" type="flip" duration="500" axis="vertical">
                                <LINK onclick="p1.set({data.url})">
                                <BOX id="front" center="true" elevation="0.1" radius="3" color="=endswith({dbExample.url},{data.url}) ? {THEME.inverseprimary} : {THEME.oninversesurface}" pad="10" opacity="0.8" layout="stack">
                                    <CENTER>
                                    <COL expand="false" halign="center">
                                        <ICON icon="{data.icon}" color="{data.color}"/>
                                        <TEXT value="{data.title}" size="12"/>
                                    </COL>
                                    </CENTER>
                                    <POS right="0" top="0">
                                        <LINK onclick="flippy.start()">
                                            <ICON icon="info_outline" size="20" color="#47C4FB" visible="=!noe({data.description})"/>
                                        </LINK>
                                    </POS>
                                </BOX>
                                </LINK>
                                <BOX id="back" halign="center" elevation="0.1" radius="3" color="{THEME.oninversesurface}" pad="10" opacity="0.8" layout="stack">
                                    <CENTER>
                                        <SCROLLER>
                                            <TEXT value="{data.description}" size="12"/>
                                        </SCROLLER>
                                    </CENTER>
                                    <POS right="0" top="0">
                                        <LINK onclick="flippy.start()">
                                            <ICON icon="info_outline" size="20" color="#47C4FB"/>
                                        </LINK>
                                    </POS>
                                </BOX>
                            </ANIMATION>
                        </PAD>
                        </ITEM>
                    </GRID>
                </ANIMATION>

                <POSITIONED right="15" top="5">
                    <COL expand="false">
                        <BUTTON onclick="fmlpad.replaceChildren({xml},false)" visible="=!{r1}">
                            <BOX width="125" height="35" color="{THEME.inverseprimary}" bordercolor="{THEME.shadow}" layout="row" radius="5" valign="center" halign="center">
                                <PAD left="10"/>
                                <ICON icon="play_arrow" size="20"/>
                                <PAD left="7"/>
                                <TEXT value="Parse"/>
                            </BOX>
                        </BUTTON>
                        <BUTTON onclick="flippy.start()">
                            <BOX width="125" height="35" color="{THEME.inverseprimary}" bordercolor="{THEME.shadow}" layout="row" radius="5" valign="center" halign="center">
                                <PAD left="10"/>
                                <TEXT value="={flippy.side} == 'front' ? 'Show Editor' : 'Show Examples'"/>
                                <PAD left="10"/>
                            </BOX>
                        </BUTTON>
                    </COL>
                </POSITIONED>

            </BOX>
        </VIEW>

        <VIEW id="fmlpad"/>

    </SPLITVIEW>
</FML>